<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>【程设大作业】mydeque | Four&#39;s</title><meta name="description" content="&amp;emsp;&amp;emsp;记录下，那段，与 STL 斗智斗勇的岁月~ Task&amp;emsp;&amp;emsp;一句话，实现 deque&lt;int&gt; 及相应的 iterator。"><meta property="og:type" content="article"><meta property="og:title" content="【程设大作业】mydeque"><meta property="og:url" content="http://kqp.world/programming_mydeque/index.html"><meta property="og:site_name" content="Four&#39;s"><meta property="og:description" content="&amp;emsp;&amp;emsp;记录下，那段，与 STL 斗智斗勇的岁月~ Task&amp;emsp;&amp;emsp;一句话，实现 deque&lt;int&gt; 及相应的 iterator。"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://kqp.world/images/mydeque1.png"><meta property="og:image" content="http://kqp.world/images/mydeque2.png"><meta property="article:published_time" content="2019-07-19T12:39:27.000Z"><meta property="article:modified_time" content="2022-01-26T09:46:16.000Z"><meta property="article:author" content="kqp"><meta property="article:tag" content="程设"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://kqp.world/images/mydeque1.png"><link rel="canonical" href="http://kqp.world/programming_mydeque/index.html"><link rel="alternate" href="/atom.xml" title="Four&#39;s" type="application/atom+xml"><link rel="icon" href="/favicon_you_3.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="//cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css" rel="stylesheet"><meta name="generator" content="Hexo 6.2.0"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.png" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">kqp</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">OIACMer / HKU_CS / LLer / TCS</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i></small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">Categories</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">Tags</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">Links</span></a></li><li class="menu-item menu-item-about"><a href="/personal/index"><i class="icon icon-cup-fill"></i> <span class="menu-title">About</span></a></li></ul><ul class="social-links"><li><a href="mailto:kuangqp1217@qq.com" target="_blank" title="Email" data-toggle="tooltip" data-placement="top"><i class="icon icon-email"></i></a></li><li><a href="http://wpa.qq.com/msgrd?v=3&uin=940240973&site=qq&menu=yes" target="_blank" title="Qq" data-toggle="tooltip" data-placement="top"><i class="icon icon-qq"></i></a></li><li><a href="https://twitter.com/yuan_four" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://github.com/l2l7l9p" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"><p>总有一天会学习前端，亲自操刀改造博客的。（发出鸽子的声音）</p></div></div></div></div><div class="widget"><h3 class="widget-title">Categories</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/OI-ACM/">OI/ACM</a><span class="category-list-count">200</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TCS/">TCS</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%BB%E7%BB%93%E4%B8%8E%E6%B8%B8%E8%AE%B0/">总结与游记</a><span class="category-list-count">38</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E5%86%99/">杂写</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%8E%A9/">玩</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9A%8F%E6%89%8Bacademy/">随手academy</a><span class="category-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Tag Cloud</h3><div class="widget-body tagcloud"><a href="/tags/CPU/" style="font-size:13px">CPU</a> <a href="/tags/RNN/" style="font-size:13px">RNN</a> <a href="/tags/ZKP/" style="font-size:13.08px">ZKP</a> <a href="/tags/complexity/" style="font-size:13.15px">complexity</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size:13px">操作系统</a> <a href="/tags/%E7%A8%8B%E8%AE%BE/" style="font-size:13.08px">程设</a> <a href="/tags/%E7%AE%97%E6%B3%95-2-SAT/" style="font-size:13.08px">算法_2-SAT</a> <a href="/tags/%E7%AE%97%E6%B3%95-DP/" style="font-size:13.92px">算法_DP</a> <a href="/tags/%E7%AE%97%E6%B3%95-FFT-NTT/" style="font-size:13.46px">算法_FFT/NTT</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E4%BD%8D%E8%BF%90%E7%AE%97/" style="font-size:13.69px">算法_位运算</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%81%8F%E5%BA%8F%E5%85%B3%E7%B3%BB/" style="font-size:13.08px">算法_偏序关系</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%87%A0%E4%BD%95/" style="font-size:13.08px">算法_几何</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%88%86%E6%B2%BB/" style="font-size:13.15px">算法_分治</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%8D%9A%E5%BC%88/" style="font-size:13.08px">算法_博弈</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%90%AF%E5%8F%91%E5%BC%8F%E5%90%88%E5%B9%B6/" style="font-size:13.08px">算法_启发式合并</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%9B%BE%E8%AE%BA/" style="font-size:13.54px">算法_图论</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%A4%9A%E9%A1%B9%E5%BC%8F-%E7%94%9F%E6%88%90%E5%87%BD%E6%95%B0/" style="font-size:13.54px">算法_多项式/生成函数</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size:13.38px">算法_字符串</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%B9%B3%E8%A1%A1%E6%A0%91-set/" style="font-size:13.08px">算法_平衡树/set</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%B9%B3%E8%A1%A1%E8%A7%84%E5%88%92%EF%BC%88%E5%AE%9A%E6%9C%9F%E9%87%8D%E6%9E%84%EF%BC%89/" style="font-size:13px">算法_平衡规划（定期重构）</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E5%B9%B6%E6%9F%A5%E9%9B%86/" style="font-size:13.31px">算法_并查集</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%89%AB%E6%8F%8F%E7%BA%BF/" style="font-size:13.08px">算法_扫描线</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%95%B0%E5%AD%A6/" style="font-size:13.08px">算法_数学</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%95%B0%E8%AE%BA/" style="font-size:13.85px">算法_数论</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%9C%80%E7%9F%AD%E8%B7%AF%E6%A8%A1%E5%9E%8B/" style="font-size:13.23px">算法_最短路模型</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%9E%84%E9%80%A0%E9%A2%98/" style="font-size:13.62px">算法_构造题</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%9E%90%E5%90%88%E6%A0%91/" style="font-size:13px">算法_析合树</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/" style="font-size:13.15px">算法_树链剖分</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%A0%B9%E5%8F%B7%E5%B9%B3%E8%A1%A1/" style="font-size:13.23px">算法_根号平衡</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E6%A6%82%E7%8E%87%E4%B8%8E%E6%9C%9F%E6%9C%9B/" style="font-size:13.31px">算法_概率与期望</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%82%B9%E5%88%86%E6%B2%BB/" style="font-size:13.15px">算法_点分治</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%8E%AF%E5%A5%97%E6%A0%91/" style="font-size:13.08px">算法_环套树</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%9F%A9%E9%98%B5%E4%B9%98%E6%B3%95/" style="font-size:13.31px">算法_矩阵乘法</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%A5%9E%E5%A5%87%E7%9A%84%E8%84%91%E6%B4%9E/" style="font-size:14px">算法_神奇的脑洞</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" style="font-size:13.23px">算法_线性代数</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%BA%BF%E6%AE%B5%E6%A0%91/" style="font-size:13.77px">算法_线段树</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%BD%91%E7%BB%9C%E6%B5%81-%E5%8C%B9%E9%85%8D/" style="font-size:13.54px">算法_网络流/匹配</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E7%BE%A4%E8%AE%BA/" style="font-size:13.08px">算法_群论</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E8%8E%AB%E9%98%9F-%E5%88%86%E5%9D%97/" style="font-size:13.46px">算法_莫队/分块</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E8%AE%A1%E6%95%B0/" style="font-size:13.23px">算法_计数</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E8%B4%AA%E5%BF%83/" style="font-size:13.23px">算法_贪心</a> <a href="/tags/%E7%AE%97%E6%B3%95-%E9%9A%8F%E6%9C%BA%E5%A4%A7%E6%B3%95/" style="font-size:13.38px">算法_随机大法</a> <a href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/" style="font-size:13.08px">编译器</a></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%80%BB%E7%BB%93%E4%B8%8E%E6%B8%B8%E8%AE%B0/">总结与游记</a></p><p class="item-title"><a href="/sum2023/" class="title">Far far away</a></p><p class="item-date"><time datetime="2024-02-12T01:39:55.000Z" itemprop="datePublished">2024-02-12</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/OI-ACM/">OI/ACM</a></p><p class="item-title"><a href="/%E3%80%902022icpc%20Regional%20%E5%8D%97%E4%BA%AC%20E%E3%80%91Color%20the%20Tree%20%E9%A2%98%E8%A7%A3/" class="title">【2022icpc Regional 南京 E】Color the Tree 题解</a></p><p class="item-date"><time datetime="2023-10-22T13:38:04.000Z" itemprop="datePublished">2023-10-22</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E7%8E%A9/">玩</a></p><p class="item-title"><a href="/liella_4th_chiba/" class="title">Liella 4th 千叶场</a></p><p class="item-date"><time datetime="2023-08-21T15:15:56.000Z" itemprop="datePublished">2023-08-21</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/TCS/">TCS</a></p><p class="item-title"><a href="/%5BSTOC2018%5DFine-grained-Reductions-from-Approximate-Counting-to-Decision/" class="title">【STOC2018】Fine-grained Reductions from Approximate Counting to Decision</a></p><p class="item-date"><time datetime="2023-06-17T03:24:12.000Z" itemprop="datePublished">2023-06-17</time></p></div></li><li><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E7%8E%A9/">玩</a></p><p class="item-title"><a href="/liyuu_2nd_guangzhou/" class="title">Liyuu 2nd 巡演广州场</a></p><p class="item-date"><time datetime="2023-05-15T13:12:56.000Z" itemprop="datePublished">2023-05-15</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-programming_mydeque" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">【程设大作业】mydeque</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/programming_mydeque/" class="article-date"><time datetime="2019-07-19T12:39:27.000Z" itemprop="datePublished">2019-07-19</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/project/">project</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/%E7%A8%8B%E8%AE%BE/" rel="tag">程设</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/programming_mydeque/#comments" class="article-comment-link">Comments</a></span></div></div><div class="article-entry marked-body" itemprop="articleBody"><p>&emsp;&emsp;记录下，那段，与 STL 斗智斗勇的岁月~</p><h1 id="Task"><a href="#Task" class="headerlink" title="Task"></a>Task</h1><p>&emsp;&emsp;一句话，实现 <code>deque&lt;int&gt;</code> 及相应的 <code>iterator</code>。<br><span id="more"></span><br>&emsp;&emsp;具体来说，你需要实现 <code>mydeque</code>、<code>myIterator</code>、<code>myrIterator</code> 三个类（不允许使用 STL），需要完成的功能如下：<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mydeque</span> &#123;</span></span><br><span class="line">	public:</span><br><span class="line">		mydeque();</span><br><span class="line">		~mydeque();</span><br><span class="line">		<span class="comment">// Add element at the end</span></span><br><span class="line">		<span class="type">void</span> <span class="title function_">push_back</span><span class="params">(<span class="type">int</span> num)</span>;</span><br><span class="line">		<span class="comment">// Add element at the front</span></span><br><span class="line">		<span class="type">void</span> <span class="title function_">push_front</span><span class="params">(<span class="type">int</span> num)</span>;</span><br><span class="line">		<span class="comment">// Insert elements at pos</span></span><br><span class="line">		<span class="type">void</span> <span class="title function_">insert</span><span class="params">(myIterator&amp; pos, <span class="type">int</span> num)</span>;</span><br><span class="line">		<span class="comment">// Erase elements</span></span><br><span class="line">		<span class="type">void</span> <span class="title function_">earse</span><span class="params">(myIterator&amp; pos)</span>;</span><br><span class="line">		<span class="comment">// Clear content</span></span><br><span class="line">		<span class="type">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line">		<span class="comment">// Access element</span></span><br><span class="line">		<span class="type">int</span>&amp; operator[](<span class="type">int</span> pos);</span><br><span class="line">		<span class="comment">// Access first element</span></span><br><span class="line">		<span class="type">int</span>&amp; <span class="title function_">front</span><span class="params">()</span>;</span><br><span class="line">		<span class="comment">// Access last element</span></span><br><span class="line">		<span class="type">int</span>&amp; <span class="title function_">back</span><span class="params">()</span>;</span><br><span class="line">		<span class="comment">// Return size</span></span><br><span class="line">		<span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>;</span><br><span class="line">		<span class="comment">// Return iterator to beginning</span></span><br><span class="line">		myIterator <span class="title function_">begin</span><span class="params">()</span>;</span><br><span class="line">		<span class="comment">// Return iterator to end</span></span><br><span class="line">		myIterator <span class="title function_">end</span><span class="params">()</span>;</span><br><span class="line">		<span class="comment">// Return reverse iterator to reverse beginning</span></span><br><span class="line">		myrIterator <span class="title function_">rbegin</span><span class="params">()</span>;</span><br><span class="line">		<span class="comment">// Return reverse iterator to reverse end</span></span><br><span class="line">		myrIterator <span class="title function_">rend</span><span class="params">()</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myIterator</span> &#123;</span></span><br><span class="line">	public:</span><br><span class="line">		myIterator&amp; operator= (<span class="type">const</span> myIterator &amp;iter);</span><br><span class="line">		<span class="type">bool</span> operator!= (<span class="type">const</span> myIterator &amp;iter);</span><br><span class="line">		<span class="type">bool</span> operator== (<span class="type">const</span> myIterator &amp;iter);</span><br><span class="line">		myIterator&amp; operator++ ();</span><br><span class="line">		myIterator operator++ (<span class="type">int</span>);</span><br><span class="line">		myIterator operator+ (<span class="type">int</span> num);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myrIterator</span> &#123;</span></span><br><span class="line">	<span class="comment">//与 myIterator 同理</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>&emsp;&emsp;可自行增加需要的函数、变量。</p><p>&emsp;&emsp;使用 Linux 下的 benchmark 评分。评分标准为跟 STL 比速度，共 18 个测试项（具体看后面的 main.cpp），每个测试项满分为 6 分，总分最终不超过 100 分。（基准实验指 <code>class mydeque : public stl::deque&lt;int&gt; &#123;&#125;</code>）</p><ul><li>程序正确运行,没有崩溃,内存泄露等错误(3.6分)</li><li>程序运行效率达到基准实验的60%(4.2分)</li><li>程序运行效率达到基准实验的70%(6.8分)</li><li>程序运行效率达到基准实验的80%(5.4分)</li><li>程序运行效率达到基准实验的100%(6分)</li></ul><p>&emsp;&emsp;STL 效率如下：<br><img src="/images/mydeque1.png" alt=""><br>&emsp;&emsp;Iteration <del>我猜</del>是一个自适应的迭代次数，就是如果你跑得快，就可以多跑一些，跑得慢就会少跑一些，最终用自己的 Iteration 除以 STL 的 Iteration 就可以直到效率比了。</p><h1 id="Sol"><a href="#Sol" class="headerlink" title="Sol"></a>Sol</h1><p>&emsp;&emsp;deque 的特性是，$O(1)$ 前端后端插入、随机访问，$O(n)$ 中间插入、删除。要做到这样，最方便的是使用一个长长的一维数组，但是这样的话迁移的效率又不是很高，而且对内存要求苛刻，因此折中一下使用块状链表，有一个大数组 <code>map</code>，里面的每一个元素都指向一个小数组，即双层数组结构。<br>&emsp;&emsp;然后它的 iterator 比较复杂，要记录两层数组的下标、所在第二层数组的开头、结尾，具体参考《STL源码剖析》。</p><script type="math/tex;mode=display">\\</script><p>&emsp;&emsp;然而，要深知，照着 STL 的写法来写一遍，是会有 debuff 的，是永远也别想跟它比效率的。<br>&emsp;&emsp;比如，就 <code>for (auto it = deq.begin(); it != deq.end(); it++) &#123;&#125;</code> 这句话，如果在 <code>it++</code> 里执行了大于等于两个操作，你甚至可能要跑 STL 的几倍到十几倍时间。。。<br>&emsp;&emsp;要想艹 STL 得高分，就必须使尽浑身解数，斗智斗勇。</p><script type="math/tex;mode=display">\\</script><p>&emsp;&emsp;首先简化一下我需要记录的东西：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MapType</span> &#123;</span></span><br><span class="line">	<span class="type">int</span> *a,num;</span><br><span class="line">&#125; *<span class="built_in">map</span>;</span><br><span class="line"><span class="type">int</span> head,tail,l,r,maxsize,totsize;</span><br></pre></td></tr></table></figure><p>&emsp;&emsp;<code>map[i].a[j]</code> 就是一个双层数组结构，用于存放东西，用一个常数 <code>alen</code> 表示每个 <code>map.a[]</code> 的定长，<code>maxsize</code> 表示第一层也就是 <code>map[]</code> 的长度（这个是要不断倍长、迁移的）。STL 的写法中记录了一头一尾两个 iterator，在这里我用 <code>head</code> 和 <code>l</code> 表示头的两个下标，<code>tail</code> 和 <code>r</code> 表示尾的两个下标。</p><p>&emsp;&emsp;做法很简单，<code>push_back()</code> 和 <code>push_front()</code> 就直接往两边放，第二层不够了就新开第二层，第一层不够了就整体倍长迁移（像 vector 那样）。<code>insert()</code> 就直接找到那个位置，然后把它右边的元素全部往后推一位，<code>erase()</code> 同理。由于第二层数组是定长的，因此简单算个数就能使用 <code>[]</code> 访问了。</p><p>&emsp;&emsp;一些优化：<br>&emsp;&emsp;比如说，myIterator 里就只放一个下标，表示它是从左往右数第几个数。毕竟测试项里没有通过 iterator 访问元素这一项，那我就牺牲这个的复杂度（把它转成通过 <code>[]</code> 来访问），换取一个飞快的 <code>for (auto it = deq.begin(); it != deq.end(); it++) &#123;&#125;</code>。<br>&emsp;&emsp;<code>insert()</code> 和 <code>erase()</code> 在 STL 里都用 iterator 来写，那么我就直接 for 循环，避免过多的调用。<br>&emsp;&emsp;能用 <code>memcpy</code> 就不要用 for 循环，要始终坚信它写的东西就是比你的快。<br>&emsp;&emsp;一个重要的优化是，<code>insert()</code> 不要鲁莽地全部往右推，判断一下它是在整个结构的左半边还是右半边，如果在左半边就左边的往左推，如果在右半边就往右推。简单分析一下效率，如果一味往右推，单次操作期望次数 $\frac{n^2}{2}$，优化以后单次操作期望次数 $2\times\frac{(\frac n2)^2}{2}=\frac{n^2}{4}$，能优化掉一半的时间。<code>erase()</code> 同理。<br>&emsp;&emsp;块大小 <code>alen</code> 可以调调参，理论上当它取 $\sqrt n$ 的时候效率是最优的（<del>学分块学疯了</del>），但是 $n$ 在实际中是未知的，而且恰好取到 $\sqrt n$ 的时候其实挺慢的，STL 其实也取得很小。<br>&emsp;&emsp;写时复制。这个我没加，但是对于这个题来说（详见 main.cpp，构造了一个 deque 之后传来传去的）显然是一个十分有用的优化。写了的人说十分有用。<br>&emsp;&emsp;自己写内存分配，不要用 <code>new</code> 和 <code>free</code>。这两个贼慢，详见 <a target="_blank" rel="noopener" href="https://ayanamists.xyz/index.php/2019/07/16/g-bug/">舍友的博客</a>。</p><p>&emsp;&emsp;放一波效率图，可以看到效率其实还是很烂，毕竟 STL 自带了很多 buff。<br><img src="/images/mydeque2.png" alt=""></p><h1 id="有趣的故事"><a href="#有趣的故事" class="headerlink" title="有趣的故事"></a>有趣的故事</h1><p>&emsp;&emsp;我的队友老哥，想写平衡树艹它，于是写了个无旋 treap。<br>&emsp;&emsp;一开始的时候，main.cpp 里的那些关于暂停的注释是没有的，也就是说，构造 deque 是不计时间的。<br>&emsp;&emsp;这位老哥的 treap 很优秀，各操作时间很平衡，于是艹爆了 STL 的 $O(n)$ 操作。但是他复制这个 treap 的时间有点慢。<br>&emsp;&emsp;万万没想到让这个 benchmark 的测评方法给栽跟头了。由于他跑太快了，于是他要跑很多次，跑很多次的话，他的复制的时间就爆掉了。<br>&emsp;&emsp;于是就出现了“我跑得太快了，所以我超时了”。</p><p>&emsp;&emsp;后来可怜的助教就把注释加上了，构造 deque 也计时间，于是他的平衡树就被打爆了，不得不写标准版。</p><h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><p>// main.cpp<br>// 这是下发的不可修改的文件<br>// 程序最后可看到 18 个测试项，括号里的数字代表数据规模<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;benchmark/benchmark.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mydeque.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="title function_">getRandom</span><span class="params">(<span class="type">long</span> from=<span class="number">0</span>, <span class="type">long</span> to=<span class="number">65536</span>)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (rand() % (to-from+<span class="number">1</span>)) + from;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mydeque <span class="title function_">constructRandomDeque</span><span class="params">(<span class="type">long</span> num)</span> &#123;</span><br><span class="line">  mydeque deq;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">    deq.push_back(i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> deq;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqempty</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123; mydeque deq; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqPushBack</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123;</span><br><span class="line">    mydeque deq;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; state.range(<span class="number">0</span>); i++) &#123;</span><br><span class="line">      deq.push_back(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqPushfront</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123;</span><br><span class="line">    mydeque deq;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> i = <span class="number">0</span>; i &lt; state.range(<span class="number">0</span>); i++) &#123;</span><br><span class="line">      deq.push_front(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqTraverse</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123;</span><br><span class="line">    mydeque deq;</span><br><span class="line">    <span class="comment">// state.PauseTiming();</span></span><br><span class="line">    deq = constructRandomDeque(state.range(<span class="number">0</span>));</span><br><span class="line">    <span class="comment">// state.ResumeTiming();</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = deq.begin(); it != deq.end(); it++) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqRtraverse</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123;</span><br><span class="line">    mydeque deq;</span><br><span class="line">    <span class="comment">// state.PauseTiming();</span></span><br><span class="line">    deq = constructRandomDeque(state.range(<span class="number">0</span>));</span><br><span class="line">    <span class="comment">// state.ResumeTiming();</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> it = deq.rbegin(); it != deq.rend(); it++) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqInsert</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123;</span><br><span class="line">    mydeque deq;</span><br><span class="line">    <span class="comment">// state.PauseTiming();</span></span><br><span class="line">    deq = constructRandomDeque(state.range(<span class="number">0</span>));</span><br><span class="line">    <span class="comment">// state.ResumeTiming();</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; state.range(<span class="number">1</span>); ++j)</span><br><span class="line">      deq.insert(deq.begin()+getRandom(<span class="number">0</span>, deq.size()<span class="number">-1</span>), getRandom());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqErase</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123;</span><br><span class="line">    mydeque deq;</span><br><span class="line">    state.PauseTiming();</span><br><span class="line">    deq = constructRandomDeque(state.range(<span class="number">0</span>));</span><br><span class="line">    <span class="type">int</span> max = state.range(<span class="number">0</span>) &gt; state.range(<span class="number">1</span>) ? state.range(<span class="number">0</span>) : state.range(<span class="number">1</span>);</span><br><span class="line">    state.ResumeTiming();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> j = <span class="number">0</span>; j &lt; state.range(<span class="number">1</span>); ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span> (deq.size()==<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        deq.erase(deq.begin()+getRandom(<span class="number">0</span>, max<span class="number">-1</span>-j));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">BM_deqAt</span><span class="params">(benchmark::State&amp; state)</span> &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> _ : state) &#123;</span><br><span class="line">    mydeque deq;</span><br><span class="line">    <span class="comment">// state.PauseTiming();</span></span><br><span class="line">    deq = constructRandomDeque(state.range(<span class="number">0</span>));</span><br><span class="line">    <span class="comment">// state.ResumeTiming();</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">long</span> j = <span class="number">0</span>; j &lt; state.range(<span class="number">1</span>); ++j)</span><br><span class="line">      deq[getRandom(<span class="number">0</span>, state.range(<span class="number">0</span>)<span class="number">-1</span>)];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// static void BM_deqSort(benchmark::State&amp; state) &#123;</span></span><br><span class="line"><span class="comment">//   mydeque deq;</span></span><br><span class="line"><span class="comment">//   for (auto _ : state) &#123;</span></span><br><span class="line"><span class="comment">//     state.PauseTiming();</span></span><br><span class="line"><span class="comment">//     deq = constructRandomDeque(state.range(0));</span></span><br><span class="line"><span class="comment">//     state.ResumeTiming();</span></span><br><span class="line"><span class="comment">//     std::sort(deq.begin(),deq.end());</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// static void BM_deqShuffle(benchmark::State&amp; state) &#123;</span></span><br><span class="line"><span class="comment">//   mydeque deq;</span></span><br><span class="line"><span class="comment">//   for (auto _ : state) &#123;</span></span><br><span class="line"><span class="comment">//     state.PauseTiming();</span></span><br><span class="line"><span class="comment">//     deq = constructRandomDeque(state.range(0));</span></span><br><span class="line"><span class="comment">//     state.ResumeTiming();</span></span><br><span class="line"><span class="comment">//     std::random_shuffle(deq.begin(),deq.end());</span></span><br><span class="line"><span class="comment">//   &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Register the function as a benchmark</span></span><br><span class="line">BENCHMARK(BM_deqempty);</span><br><span class="line">BENCHMARK(BM_deqPushBack)-&gt;Arg(<span class="number">32</span>)-&gt;Arg(<span class="number">65536</span>)-&gt;Arg(<span class="number">1L</span>&lt;&lt;<span class="number">22</span>);</span><br><span class="line"><span class="comment">//BENCHMARK(BM_deqPushfront)-&gt;Arg(32)-&gt;Arg(65536)-&gt;Arg(1L&lt;&lt;22);</span></span><br><span class="line">BENCHMARK(BM_deqTraverse)-&gt;Arg(<span class="number">32</span>)-&gt;Arg(<span class="number">65536</span>)-&gt;Arg(<span class="number">1L</span>&lt;&lt;<span class="number">22</span>);</span><br><span class="line">BENCHMARK(BM_deqRtraverse)-&gt;Arg(<span class="number">32</span>)-&gt;Arg(<span class="number">65536</span>)-&gt;Arg(<span class="number">1L</span>&lt;&lt;<span class="number">22</span>);</span><br><span class="line">BENCHMARK(BM_deqInsert)-&gt;Args(&#123;<span class="number">32</span>, <span class="number">512</span>&#125;)-&gt;Args(&#123;<span class="number">65536</span>, <span class="number">512</span>&#125;)-&gt;Args(&#123;<span class="number">1L</span>&lt;&lt;<span class="number">22</span>, <span class="number">512</span>&#125;);</span><br><span class="line">BENCHMARK(BM_deqErase)-&gt;Args(&#123;<span class="number">512</span>, <span class="number">512</span>&#125;)-&gt;Args(&#123;<span class="number">65536</span>, <span class="number">512</span>&#125;)-&gt;Args(&#123;<span class="number">1L</span>&lt;&lt;<span class="number">22</span>, <span class="number">512</span>&#125;);</span><br><span class="line">BENCHMARK(BM_deqAt)-&gt;Args(&#123;<span class="number">32</span>, <span class="number">128</span>&#125;)-&gt;Args(&#123;<span class="number">65536</span>, <span class="number">128</span>&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqPushfront)-&gt;RangeMultiplier(32)-&gt;Range(8L, 8L&lt;&lt;20);</span></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqTraverse)-&gt;RangeMultiplier(32)-&gt;Range(8L, 8L&lt;&lt;20);</span></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqRtraverse)-&gt;RangeMultiplier(32)-&gt;Range(8L, 8L&lt;&lt;20);</span></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqInsert)-&gt;Ranges(&#123;&#123;32L, 8L&lt;&lt;22&#125;, &#123;128, 512&#125;&#125;);</span></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqErase)-&gt;Ranges(&#123;&#123;32L, 8L&lt;&lt;22&#125;, &#123;128, 512&#125;&#125;);</span></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqAt)-&gt;Ranges(&#123;&#123;32L, 8L&lt;&lt;22&#125;, &#123;128, 512&#125;&#125;);</span></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqSort)-&gt;RangeMultiplier(32)-&gt;Range(8L, 8L&lt;&lt;20);</span></span><br><span class="line"><span class="comment">// BENCHMARK(BM_deqShuffle)-&gt;RangeMultiplier(32)-&gt;Range(8L, 8L&lt;&lt;22);</span></span><br><span class="line"></span><br><span class="line">BENCHMARK_MAIN();</span><br></pre></td></tr></table></figure><br>// mydeque.hpp<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYDEQUE_HPP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYDEQUE_HPP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;myIterator.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mydeque</span> &#123;</span></span><br><span class="line">	public:</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">MapType</span> &#123;</span></span><br><span class="line">			<span class="type">int</span> *a,num;</span><br><span class="line">		&#125; *<span class="built_in">map</span>;</span><br><span class="line">		<span class="type">int</span> head,tail,l,r,maxsize,totsize;</span><br><span class="line">		</span><br><span class="line">		<span class="type">void</span> <span class="title function_">NewMapType</span><span class="params">(MapType &amp;x)</span>;</span><br><span class="line">		<span class="type">void</span> <span class="title function_">ChangeMap</span><span class="params">()</span>;</span><br><span class="line">		<span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">Release</span><span class="params">()</span>;</span><br><span class="line">		<span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">init</span><span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		mydeque();</span><br><span class="line">		~mydeque();</span><br><span class="line">		mydeque&amp; operator = (<span class="type">const</span> mydeque &amp;deq);</span><br><span class="line">		</span><br><span class="line">		<span class="type">void</span> <span class="title function_">push_back</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;val)</span>;</span><br><span class="line">		<span class="type">void</span> <span class="title function_">push_front</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;val)</span>;</span><br><span class="line">		<span class="type">void</span> <span class="title function_">insert</span><span class="params">(myIterator pos,<span class="type">int</span> val)</span>;</span><br><span class="line">		<span class="type">void</span> <span class="title function_">erase</span><span class="params">(<span class="type">const</span> myIterator &amp;pos)</span>;</span><br><span class="line">		<span class="type">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="type">int</span>&amp; operator [] (<span class="type">int</span> i);</span><br><span class="line">		<span class="type">int</span>&amp; <span class="title function_">front</span><span class="params">()</span>;</span><br><span class="line">		<span class="type">int</span>&amp; <span class="title function_">back</span><span class="params">()</span>;</span><br><span class="line">		<span class="type">int</span> <span class="title function_">size</span><span class="params">()</span>;</span><br><span class="line">		</span><br><span class="line">		myIterator <span class="title function_">begin</span><span class="params">()</span>;</span><br><span class="line">		myIterator <span class="title function_">end</span><span class="params">()</span>;</span><br><span class="line">		myrIterator <span class="title function_">rbegin</span><span class="params">()</span>;</span><br><span class="line">		myrIterator <span class="title function_">rend</span><span class="params">()</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><br>// myIterator.hpp<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYITERATOR_HPP</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYITERATOR_HPP</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> alen=<span class="number">130</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myIterator</span> &#123;</span></span><br><span class="line">	public:</span><br><span class="line">		<span class="type">int</span> pos;</span><br><span class="line">		</span><br><span class="line">		myIterator(<span class="type">int</span> x=<span class="number">0</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="type">bool</span> operator != (<span class="type">const</span> myIterator &amp;iter);</span><br><span class="line">		<span class="type">bool</span> operator == (<span class="type">const</span> myIterator &amp;iter);</span><br><span class="line">		myIterator&amp; operator ++ ();</span><br><span class="line">		myIterator&amp; operator -- ();</span><br><span class="line">		myIterator operator ++ (<span class="type">int</span>);</span><br><span class="line">		myIterator operator + (<span class="type">int</span> num);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myrIterator</span> &#123;</span></span><br><span class="line">	public:</span><br><span class="line">		<span class="type">int</span> pos;</span><br><span class="line">		</span><br><span class="line">		myrIterator(<span class="type">int</span> x=<span class="number">0</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="type">bool</span> operator != (<span class="type">const</span> myrIterator &amp;iter);</span><br><span class="line">		<span class="type">bool</span> operator == (<span class="type">const</span> myrIterator &amp;iter);</span><br><span class="line">		myrIterator&amp; operator ++ ();</span><br><span class="line">		myrIterator&amp; operator -- ();</span><br><span class="line">		myrIterator operator ++ (<span class="type">int</span>);</span><br><span class="line">		myrIterator operator + (<span class="type">int</span> num);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><br>// mydeque.cpp<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;mydeque.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fo(i,a,b) for(int i=a;i&lt;=b;i++)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> fd(i,a,b) for(int i=a;i&gt;=b;i--)</span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">mydeque::NewMapType</span><span class="params">(mydeque::MapType &amp;x)</span></span><br><span class="line">&#123;</span><br><span class="line">	x.a=new <span class="type">int</span>[alen+<span class="number">2</span>];</span><br><span class="line">	x.num=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mydeque::ChangeMap</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> len=maxsize, half=len&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	maxsize&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">	MapType *newmap=new MapType[maxsize+<span class="number">2</span>];</span><br><span class="line">	<span class="built_in">memcpy</span>(newmap+half,<span class="built_in">map</span>,len*<span class="keyword">sizeof</span>(MapType));</span><br><span class="line">	delete[] <span class="built_in">map</span>;</span><br><span class="line">	<span class="built_in">map</span>=newmap;</span><br><span class="line">	head+=half, tail+=half;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">mydeque::Release</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	fo(i,head,tail) delete[] <span class="built_in">map</span>[i].a;</span><br><span class="line">	delete[] <span class="built_in">map</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">mydeque::init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	maxsize=<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">map</span>=new MapType[maxsize+<span class="number">2</span>];</span><br><span class="line">	NewMapType(<span class="built_in">map</span>[<span class="number">1</span>]);</span><br><span class="line">	head=tail=<span class="number">1</span>;</span><br><span class="line">	l=<span class="number">1</span>, r=<span class="number">0</span>;</span><br><span class="line">	totsize=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mydeque::mydeque()</span><br><span class="line">&#123;</span><br><span class="line">	init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mydeque::~mydeque()</span><br><span class="line">&#123;</span><br><span class="line">	Release();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mydeque&amp; mydeque::operator = (<span class="type">const</span> mydeque &amp;deq)</span><br><span class="line">&#123;</span><br><span class="line">	Release();</span><br><span class="line">	maxsize=deq.maxsize;</span><br><span class="line">	head=deq.head, tail=deq.tail;</span><br><span class="line">	l=deq.l, r=deq.r;</span><br><span class="line">	totsize=deq.totsize;</span><br><span class="line">	<span class="built_in">map</span>=new MapType[maxsize+<span class="number">2</span>];</span><br><span class="line">	fo(i,head,tail)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">map</span>[i].num=deq.<span class="built_in">map</span>[i].num;</span><br><span class="line">		<span class="built_in">map</span>[i].a=new <span class="type">int</span>[alen+<span class="number">2</span>];</span><br><span class="line">		<span class="built_in">memcpy</span>(<span class="built_in">map</span>[i].a,deq.<span class="built_in">map</span>[i].a,<span class="keyword">sizeof</span>(<span class="built_in">map</span>[i].a));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mydeque::push_back</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (r==alen)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (tail==maxsize<span class="number">-1</span>) ChangeMap();</span><br><span class="line">		NewMapType(<span class="built_in">map</span>[++tail]);</span><br><span class="line">		r=<span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">map</span>[tail].num++;</span><br><span class="line">	<span class="built_in">map</span>[tail].a[++r]=val;</span><br><span class="line">	totsize++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mydeque::push_front</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (head==<span class="number">0</span>) ChangeMap();</span><br><span class="line">		NewMapType(<span class="built_in">map</span>[--head]);</span><br><span class="line">		l=alen+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">map</span>[head].num++;</span><br><span class="line">	<span class="built_in">map</span>[head].a[--l]=val;</span><br><span class="line">	totsize++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mydeque::insert</span><span class="params">(myIterator pos,<span class="type">int</span> val)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (pos.pos&gt;=(totsize&gt;&gt;<span class="number">1</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		push_back(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=tail, cnt=totsize<span class="number">-1</span>; cnt!=pos.pos; --i)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=(i==tail ?r :alen); j&gt;=<span class="number">1</span> &amp;&amp; cnt!=pos.pos; --j, --cnt)</span><br><span class="line">				<span class="built_in">map</span>[i].a[j]=(j==<span class="number">1</span>) ?<span class="built_in">map</span>[i<span class="number">-1</span>].a[alen] :<span class="built_in">map</span>[i].a[j<span class="number">-1</span>] ;</span><br><span class="line">	&#125; <span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		push_front(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=head, cnt=<span class="number">0</span>; cnt!=pos.pos; ++i)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=(i==head ?l :<span class="number">1</span>); j&lt;=alen &amp;&amp; cnt!=pos.pos; ++j, ++cnt)</span><br><span class="line">				<span class="built_in">map</span>[i].a[j]=(j==alen) ?<span class="built_in">map</span>[i+<span class="number">1</span>].a[<span class="number">1</span>] :<span class="built_in">map</span>[i].a[j+<span class="number">1</span>] ;</span><br><span class="line">	&#125;</span><br><span class="line">	(*this)[pos.pos]=val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mydeque::erase</span><span class="params">(<span class="type">const</span> myIterator &amp;pos)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (pos.pos&gt;=(totsize&gt;&gt;<span class="number">1</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=tail, cnt=totsize<span class="number">-1</span>, last=<span class="built_in">map</span>[i].a[(i==tail ?r :alen)], t, *p; cnt!=pos.pos; --i)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=(i==tail ?r :alen); j&gt;=<span class="number">1</span> &amp;&amp; cnt!=pos.pos; --j, --cnt)</span><br><span class="line">			&#123;</span><br><span class="line">				p=(j==<span class="number">1</span>) ?&amp;(<span class="built_in">map</span>[i<span class="number">-1</span>].a[alen]) :&amp;(<span class="built_in">map</span>[i].a[j<span class="number">-1</span>]) ;</span><br><span class="line">				t=*p, *p=last, last=t;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="built_in">map</span>[tail].num--;</span><br><span class="line">		<span class="keyword">if</span> (--r==<span class="number">0</span>) &#123;delete[] <span class="built_in">map</span>[tail--].a; r=alen;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=head, cnt=<span class="number">0</span>, last=<span class="built_in">map</span>[i].a[(i==head ?l :<span class="number">1</span>)], t, *p; cnt!=pos.pos; ++i)</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> j=(i==head ?l :<span class="number">1</span>); j&lt;=alen &amp;&amp; cnt!=pos.pos; ++j, ++cnt)</span><br><span class="line">			&#123;</span><br><span class="line">				p=(j==alen) ?&amp;(<span class="built_in">map</span>[i+<span class="number">1</span>].a[<span class="number">1</span>]) :&amp;(<span class="built_in">map</span>[i].a[j+<span class="number">1</span>]) ;</span><br><span class="line">				t=*p, *p=last, last=t;</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="built_in">map</span>[head].num--;</span><br><span class="line">		<span class="keyword">if</span> (++l&gt;alen) &#123;delete[] <span class="built_in">map</span>[head++].a; l=<span class="number">1</span>;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	totsize--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">mydeque::clear</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	Release();</span><br><span class="line">	init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>&amp; mydeque::operator [] (<span class="type">int</span> i)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (i&lt;<span class="built_in">map</span>[head].num) <span class="keyword">return</span> <span class="built_in">map</span>[head].a[l+i];</span><br><span class="line">	i-=<span class="built_in">map</span>[head].num;</span><br><span class="line">	<span class="type">int</span> index=i/alen;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">map</span>[head+index+<span class="number">1</span>].a[i-index*alen+<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>&amp; <span class="title function_">mydeque::front</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">map</span>[head].a[l];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>&amp; <span class="title function_">mydeque::back</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">map</span>[tail].a[r];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">mydeque::size</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> totsize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myIterator <span class="title function_">mydeque::begin</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> myIterator(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myIterator <span class="title function_">mydeque::end</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> myIterator(totsize);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myrIterator <span class="title function_">mydeque::rbegin</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> myrIterator(totsize<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myrIterator <span class="title function_">mydeque::rend</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> myrIterator(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>// myIterator.cpp<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;myIterator.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//myIterator</span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> myIterator::operator != (<span class="type">const</span> myIterator &amp;iter)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (this-&gt;pos!=iter.pos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> myIterator::operator == (<span class="type">const</span> myIterator &amp;iter)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (this-&gt;pos==iter.pos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myIterator::myIterator(<span class="type">int</span> x)</span><br><span class="line">&#123;</span><br><span class="line">	pos=x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myIterator&amp; myIterator::operator ++ ()</span><br><span class="line">&#123;</span><br><span class="line">	++pos;</span><br><span class="line">	<span class="keyword">return</span> *this;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myIterator&amp; myIterator::operator -- ()</span><br><span class="line">&#123;</span><br><span class="line">	--pos;</span><br><span class="line">	<span class="keyword">return</span> *this;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myIterator myIterator::operator ++ (<span class="type">int</span>)</span><br><span class="line">&#123;</span><br><span class="line">	myIterator re=*this;</span><br><span class="line">	++pos;</span><br><span class="line">	<span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myIterator myIterator::operator + (<span class="type">int</span> num)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> myIterator(this-&gt;pos+num);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//myrIterator</span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> myrIterator::operator != (<span class="type">const</span> myrIterator &amp;iter)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (this-&gt;pos!=iter.pos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> myrIterator::operator == (<span class="type">const</span> myrIterator &amp;iter)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> (this-&gt;pos==iter.pos);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myrIterator::myrIterator(<span class="type">int</span> x)</span><br><span class="line">&#123;</span><br><span class="line">	pos=x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myrIterator&amp; myrIterator::operator ++ ()</span><br><span class="line">&#123;</span><br><span class="line">	--pos;</span><br><span class="line">	<span class="keyword">return</span> *this;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myrIterator&amp; myrIterator::operator -- ()</span><br><span class="line">&#123;</span><br><span class="line">	++pos;</span><br><span class="line">	<span class="keyword">return</span> *this;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myrIterator myrIterator::operator ++ (<span class="type">int</span>)</span><br><span class="line">&#123;</span><br><span class="line">	myrIterator re=*this;</span><br><span class="line">	--pos;</span><br><span class="line">	<span class="keyword">return</span> re;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">myrIterator myrIterator::operator + (<span class="type">int</span> num)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> myrIterator(this-&gt;pos-num);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="http://kqp.world/programming_mydeque/" title="【程设大作业】mydeque" target="_blank" rel="external">http://kqp.world/programming_mydeque/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.png" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="" target="_blank"><span class="text-dark">kqp</span><small class="ml-1x">OIACMer / HKU_CS / LLer / TCS</small></a></h3><div>糖少许，盐少许</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/%E3%80%90AtCoder%20Grand%20036B%E3%80%91Do%20Not%20Duplicate%20%E9%A2%98%E8%A7%A3/" title="【AtCoder Grand 036B】Do Not Duplicate 题解"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/short_sol_oj/" title="【长更】一句话题解（各大oj）"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="mailto:kuangqp1217@qq.com" target="_blank" title="Email" data-toggle="tooltip" data-placement="top"><i class="icon icon-email"></i></a></li><li><a href="http://wpa.qq.com/msgrd?v=3&uin=940240973&site=qq&menu=yes" target="_blank" title="Qq" data-toggle="tooltip" data-placement="top"><i class="icon icon-qq"></i></a></li><li><a href="https://twitter.com/yuan_four" target="_blank" title="Twitter" data-toggle="tooltip" data-placement="top"><i class="icon icon-twitter"></i></a></li><li><a href="https://github.com/l2l7l9p" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!0,appId:"YsBbwGr5CQ2WyuobqGxOedtu-gzGzoHsz",appKey:"Wplm0hz1L65wFVye5hE8tOTf",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>